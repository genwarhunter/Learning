
## 1. Какие базовые цепочки и таблицы существуют в iptables и для чего служат?

**_Цепочки:_**

	PREROUTING – позволяет модифицировать пакет до принятия решения о маршрутизации.

	INPUT – позволяет модифицировать пакет, предназначенный самому хосту.

	FORWARD – цепочка, позволяющая модифицировать транзитные пакеты.

	OUTPUT – позволяет модифицировать пакеты, исходящие от самого хоста.

	POSTROUTING – дает возможность модифицировать все исходящие пакеты, как сгенерированные самим хостом, так и транзитные.

**_Таблицы:_**

	raw – предназначена для обработки пакетов прежде, чем они будут переданы системе conntrack, которая занимается отслеживанием состояния соединений и принадлежностью пакетов этим соединениям. Содержит встроенные цепочки PREROUTING и OUTPUT.

	mangle – используется для модификации некоторых заголовков (TTL, TOS) и маркировки пакетов и соединений, содержит цепочки PREROUTING, INPUT, FORWARD, OUTPUT и POSTROUTING.

	nat – предназначена для преобразования адресов и портов источника и назначения пакетов, встроенные цепочки: PREROUTING, OUTPUT, POSTROUTING.

	filter – применяется, собственно, для фильтрации пакетов, является таблицей по умолчанию, т.е. если таблица не указана явно, то используется filter, имеет цепочки INPUT, FORWARD и OUTPUT.

	security – используется для работы совместно с системами принудительного контроля доступа, такими как SELinux. Встроенные цепочки INPUT, FORWARD, OUTPUT
## 2. Опишите процесс обработки пакета который предназначен данной системе
Пакет пройдёт по такому пути:

	PREROUTING  -> INPUT -> Local Process -> OUTPUT -> POSTROUTING
## 3. Что такое conntrack и для чего используется?
Conntrack – компонент, позволяющий ядру отслеживать все логические сетевые соединения или потоки, тем самым идентифицировать все пакеты, которые составляют каждый поток, чтобы их можно было последовательно обрабатывать вместе.
## 4. Какими командами создать/удалить цепочку? создать/удалить правило? создать правило до определенного правила в цепочке?
Создать цепочку:

	iptables -N CHAINNEW_
Удалить цепочку:

	iptables -X CHAINNEW_

Создать правило:

	iptables -A CHAIN -s 192.168.0.1 -j ACTION

Удалить правило:

	iptables -D CHAIN

Создать правило до определённого правила в цепочке:

	iptables -I CHAIN 5 -s 192.168.0.1 -j ACTION

# Практика

 - Взять за основу конфигурационный файл iptables ниже, поднять в системе веб сервер. 
	- `sudo service ssh start`
	- `sudo iptables-restore < chelgu_iptables`
 - Настроить правила которые разрешают доступ на этот сервер с определенной подсети или хоста в которой находитесь вы как клиент, продемонстрировать что работает icmp
	- `sudo iptables -I INPUT -s 192.168.0.103 -p tcp --dport ssh -j ACCEPT`
	- ![](https://i.imgur.com/hLPHY7H.png)
	- ![](https://i.imgur.com/ie7qg7n.png)
- Затем закрыть доступ из этой подсети по icmp, оставив доступ по ssh, продемонстрировать что хост по ssh доступен а icmp нет
	- `sudo iptables -I INPUT -p icmp -j DROP`
	- ![](https://i.imgur.com/XjP7go4.png)
	- ![](https://i.imgur.com/RASPUAA.png)
- Запретить только ssh, но icmp работает
	- `sudo iptables -D INPUT 1` x2
	- `sudo iptables -I INPUT -s 192.168.0.103 -p tcp --dport ssh -j DROP`
	- ![](https://i.imgur.com/lugfO20.png)
	- ![](https://i.imgur.com/MzwMDKR.png)